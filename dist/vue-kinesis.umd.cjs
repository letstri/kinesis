(function(c,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(c=typeof globalThis<"u"?globalThis:c||self,r(c["vue-kinesis"]={},c.Vue))})(this,function(c,r){"use strict";function m(t,e){return{x:t,y:e}}function Y(t){return m(t?t.width/2:0,t?t.height/2:0)}function $(t){const{target:e,event:n}=t,i=n.clientX,s=n.clientY,o=i-e.left,a=s-e.top,l=Y(e),h=o/l.x,u=a/l.y;return{...m(h,u),target:e}}function D(t){const{target:e}=t,n=(e.left-window.innerWidth)/(e.width+window.innerWidth),i=(e.top-window.innerHeight)/(e.height+window.innerHeight);return{...m(n,i),target:e}}function N(t){const{event:e,target:n}=t,i=e.gamma/45,s=e.beta/90;return{...m(i,s),target:n}}function v(t){return t.bottom>=0&&t.right>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)}function p(){try{return/Mobi|Android/i.test(navigator.userAgent)}catch{return!0}}function g(t,e,n){let i,s;return function(){const o=this;let a;n==="scroll"?a=e:a=o.duration>1e3?e:o.duration/10;const l=+new Date,h=arguments;i&&l<i+a?(clearTimeout(s),s=setTimeout(()=>{requestAnimationFrame(()=>{i=l,t.apply(o,h)})},a)):requestAnimationFrame(()=>{i=l,t.apply(o,h)})}}const P={props:{audio:{type:String,required:!1},playAudio:{type:Boolean,default:!1}},data(){return{analyser:null,audioArray:null,audioData:null,audioRef:null,wasPlayed:!1,isPlaying:!1}},watch:{audio(){this.wasPlayed=!1,this.isPlaying=!1},playAudio(t){t?this.play():this.stop()}},methods:{play(){this.active&&(this.wasPlayed||(this.handleAudio(),this.wasPlayed=!0),this.isPlaying=!0,this.audioRef.play(),this.getSongData())},stop(){this.isPlaying=!1,this.audioRef.pause()},handleAudio(){const{audio:t}=this.$refs;this.audioRef=t;const e=new AudioContext,n=e.createMediaElementSource(t),i=e.createAnalyser();n.connect(i),i.connect(e.destination),i.fftSize=256;const s=i.frequencyBinCount,o=new Uint8Array(s);this.audioArray=o,this.analyser=i},getSongData(){this.isPlaying&&(this.analyser.getByteFrequencyData(this.audioArray),this.audioData=new Array(this.audioArray),requestAnimationFrame(this.getSongData))}}},y=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},C={name:"KinesisContainer",mixins:[P],props:{tag:{type:String,default:"div"},event:{type:String,default:"move"},active:{type:Boolean,default:!0},duration:{type:Number,default:1e3},easing:{type:String,default:"cubic-bezier(0.23, 1, 0.32, 1)"},perspective:{type:Number,default:1e3}},provide(){const t={};return["audioData","duration","easing","event","eventData","isMoving","movement","shape"].forEach(n=>Object.defineProperty(t,n,{enumerable:!0,get:()=>this[n]})),{context:t}},data(){var t;return{shape:(t=this.$el)==null?void 0:t.getBoundingClientRect(),isMoving:!1,leftOnce:!1,movement:{x:0,y:0},eventMap:{orientation:"deviceorientation",scroll:"scroll",move:p()?"deviceorientation":null}}},computed:{eventActions(){var t;return{move:{action:$,condition:this.isMoving&&!p(),type:p()?"deviceorientation":null},scroll:{action:D,condition:!!((t=this.shape)!=null&&t.height),type:"scroll"},orientation:{action:N,condition:this.event==="move"&&p(),type:"deviceorientation"}}},style(){return{perspective:`${this.perspective}px`}}},mounted(){this.addEvents()},beforeDestroy(){this.removeEvents()},methods:{handleMovementStart(){this.active&&(this.isMoving=!0)},handleMovementStop(){this.active&&(this.leftOnce=!0,this.isMoving=!1)},handleMovement:g(function(t){if(!this.active)return;!this.isMoving&&!this.leftOnce&&this.handleMovementStart(),this.shape=this.$el.getBoundingClientRect();const e=v(this.shape),n=this.eventActions[this.event].condition,i=this.eventActions[this.event].action;e&&n&&(this.movement=i({target:this.shape,event:t}),this.eventData=m(t.clientX,t.clientY))},100),addEvents(){this.eventMap[this.event]&&window.addEventListener(this.eventMap[this.event],this.handleMovement,!0)},removeEvents(){this.eventMap[this.event]&&window.removeEventListener(this.eventMap[this.event],this.handleMovement,!0)}}},_=["src"];function B(t,e,n,i,s,o){return r.openBlock(),r.createBlock(r.resolveDynamicComponent(n.tag),{style:r.normalizeStyle(o.style),onMousemove:o.handleMovement,onMouseenter:o.handleMovementStart,onMouseleave:o.handleMovementStop},{default:r.withCtx(()=>[r.renderSlot(t.$slots,"default"),t.audio?(r.openBlock(),r.createElementBlock("audio",{key:0,ref:"audio",type:"audio/mpeg",onEnded:e[0]||(e[0]=(...a)=>t.stop&&t.stop(...a))},[r.createElementVNode("source",{src:t.audio},null,8,_)],544)):r.createCommentVNode("",!0)]),_:3},40,["style","onMousemove","onMouseenter","onMouseleave"])}const M=y(C,[["render",B]]);function x(t,e,n){return n&&t>n?n:e&&t<e?e:t}function E(t){const{y:e,x:n,target:i,originX:s=50,strength:o=10,event:a=null,minX:l,minY:h,maxX:u,maxY:f}=t;let{originY:d=50}=t;a==="scroll"&&(d=-d/2);const V=x((n-s/50)*o,l,u),z=x((e-d/50)*o,h,f);return{...m(V,z),target:i}}const w={methods:{transformSwitch(t,e,n,i){t=t==="scaleX"||t==="scaleY"?"scale":t;let s;switch(t){case"translate":s=this.translateMovement(e,n);break;case"rotate":s=this.rotateMovement(e,n);break;case"depth":s=this.depthMovement(e,n,i);break;case"depth_inv":s=this.depthMovement(-e,-n,i);break;case"scale":s=this.scaleMovement(e,n);break}return s},translateMovement(t,e){return`translate3d(${-t}px, ${-e}px, 0)`},rotateMovement(t,e){let n;return this.axis?this.axis==="x"?n=2*t:this.axis==="y"&&(n=2*e):n=t+e,`rotate3d(0,0,1,${n}deg)`},depthMovement(t,e,n){return`rotateX(${-e}deg) rotateY(${t}deg) translate3d(0,0,${n*2}px)`},scaleMovement(t,e){const{type:n}=this,i=Math.sign(this.strength)*(Math.abs(t)+Math.abs(e))/10+1;return`scale3d(${n==="scaleX"||n==="scale"?i:1},
            ${n==="scaleY"||n==="scale"?i:1},
            1)`}}};function A(t){const{referencePosition:e,shape:n,event:i,cycles:s,strength:o}=t,a=i==="scroll"?window.innerWidth:n.width,l=i==="scroll"?window.innerHeight:n.height,h=(e.x-n.left)*(Math.PI*2)/a,u=(e.y-n.top)*(Math.PI*2)/l,f=a*Math.sin(h*s),d=l*Math.sin(u*s);return m(f*o/(a/2),d*o/(l/2))}const k={name:"KinesisElement",mixins:[w],props:{tag:{type:String,default:"div"},type:{type:String,default:"translate"},transformOrigin:{type:String,default:"center"},originX:{type:Number,default:50},originY:{type:Number,default:50},strength:{type:Number,default:10},axis:{type:String,default:null},maxX:{type:Number,default:null},maxY:{type:Number,default:null},minX:{type:Number,default:null},minY:{type:Number,default:null},cycle:{type:Number,default:0}},inject:["context"],computed:{transform(){return this.transformCalculation()},transformParameters(){return{transitionProperty:"transform",transitionDuration:this.transitionDuration,transformOrigin:this.transformOrigin,transitionTimingFunction:this.transitionTimingFunction}},transitionDuration(){const{duration:t}=this.context;return`${t}ms`},transitionTimingFunction(){return this.context.easing}},methods:{transformCalculation(){const{context:t}=this;if(!t.shape||!t.isMoving&&t.event==="move")return{};let e,n;const{x:i,y:s}=this.cycle<1?E({...t.movement,originX:this.originX,originY:this.originY,strength:this.strengthManager(),event:t.event,minX:this.minX,minY:this.minY,maxX:this.maxX,maxY:this.maxY}):A({referencePosition:t.event==="scroll"?{x:0,y:0}:t.eventData,shape:t.shape,event:t.event,cycles:this.cycle,strength:this.strengthManager()});return t.event!=="scroll"?(e=this.axis==="y"?0:i,n=this.axis==="x"?0:s):t.event==="scroll"?(e=this.axis==="x"?s:0,n=this.axis==="y"||!this.axis?s:0):this.cycle>0&&(e=this.axis==="x"?i:0,n=this.axis==="y"?s:0),{transform:this.transformSwitch(this.type,e,n,this.strength)}},strengthManager(){return this.type==="depth"||this.type==="depth_inv"?Math.abs(this.strength):this.strength}}};function K(t,e,n,i,s,o){return r.openBlock(),r.createBlock(r.resolveDynamicComponent(n.tag),{style:r.normalizeStyle({...o.transform,...o.transformParameters})},{default:r.withCtx(()=>[r.renderSlot(t.$slots,"default")]),_:3},8,["style"])}const b=y(k,[["render",K]]),O={name:"KinesisScroll",mixins:[{props:{active:{type:Boolean,default:!0},duration:{type:Number,default:1e3},easing:{type:String,default:"cubic-bezier(0.23, 1, 0.32, 1)"},tag:{type:String,default:"div"}}},{props:{perspective:{type:Number,default:1e3}},computed:{style(){return{perspective:`${this.perspective}px`}}}},{props:{type:{type:String,default:"translate"},transformOrigin:{type:String,default:"center"},originX:{type:Number,default:50},originY:{type:Number,default:50},strength:{type:Number,default:10},audioIndex:{type:Number,default:50},axis:{type:String,default:null},maxX:{type:Number,default:null},maxY:{type:Number,default:null},minX:{type:Number,default:null},minY:{type:Number,default:null},cycle:{type:Number,default:0}},methods:{strengthManager(){return this.type==="depth"||this.type==="depth_inv"?Math.abs(this.strength):this.strength}}},w],data(){return{transform:{}}},computed:{transformParameters(){return{transitionProperty:"transform",transitionDuration:this.transitionDuration,transformOrigin:this.transformOrigin,transitionTimingFunction:this.easing}},transitionDuration(){return`${this.duration}ms`}},mounted(){window.addEventListener("scroll",this.handleScroll,{passive:!0})},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll,{passive:!0})},methods:{getCycleMovement(t,e,n,i,s){const o=(t-s.left)*(Math.PI*2)/n,a=(e-s.top)*(Math.PI*2)/i;this.cycleMovement={x:o,y:a,width:n,height:i}},handleScroll:g(function(){if(!this.active)return;const t=this.$el.getBoundingClientRect();v(t)&&t.height&&this.transformBehavior(t)},19,"scroll"),transformBehavior(t){let e,n;const i=(t.top-window.innerHeight)/(t.height+window.innerHeight);if(this.cycle<=0){const a=i*this.strength;e=this.axis==="x"?a:0,n=this.axis==="y"||!this.axis?a:0,this.maxX&&(e=Math.min(e,this.maxX)),this.minX&&(e=Math.max(e,this.minX)),this.maxY&&(n=Math.min(n,this.maxY)),this.minY&&(n=Math.max(n,this.minY))}else if(this.cycle>0){const{x:a,y:l,width:h,height:u}=this.getCycleMovement(0,0,window.innerWidth,window.innerHeight,t),f=h*Math.sin(a*this.cycle),d=u*Math.sin(l*this.cycle);e=this.axis==="x"?f/(h/2)*this.strength:0,n=this.axis==="y"||!this.axis?d/(u/2)*this.strength:0}let s=this.type;s=s==="scaleX"||s==="scaleY"?"scale":s;const o=this.transformSwitch(s,e,n,this.strength);this.transform={transform:o}}}};function T(t,e,n,i,s,o){return r.openBlock(),r.createBlock(r.resolveDynamicComponent(t.tag),{style:r.normalizeStyle({...s.transform,...o.transformParameters})},{default:r.withCtx(()=>[r.renderSlot(t.$slots,"default")]),_:3},8,["style"])}const S=y(O,[["render",T]]),R={name:"KinesisDistance",props:{tag:{type:String,default:"div"},type:{type:String,default:"translate"},transformOrigin:{type:String,default:"center"},originX:{type:Number,default:50},originY:{type:Number,default:50},strength:{type:Number,default:10},axis:{type:String,default:null},maxX:{type:Number,default:null},maxY:{type:Number,default:null},minX:{type:Number,default:null},minY:{type:Number,default:null},distance:{type:Number,default:100},cycle:{type:Number,default:0},active:{type:Boolean,default:!0},duration:{type:Number,default:1001},easing:{type:String,default:"cubic-bezier(0.23, 1, 0.32, 1)"},perspective:{type:Number,default:1e3}},data(){return{pointer:{x:0,y:0},transform:{},component:"kidistance",throttle:500}},computed:{style(){return{perspective:`${this.perspective}px`}},transformParameters(){return{position:"relative",transitionProperty:"transform",transitionDuration:this.transitionDuration,transformOrigin:this.transformOrigin,transitionTimingFunction:this.easing}},transitionDuration(){return`${this.duration}ms`}},mounted(){window.addEventListener("scroll",this.handleMovement)},beforeDestroy(){window.removeEventListener("scroll",this.handleMovement)},methods:{getCoordinates(t,e){const n=this.$el.getBoundingClientRect();return{x:t+n.left,y:e+n.top}},getDistance(t,e,n,i){return Math.floor(Math.hypot(e-t,i-n))},handleMovement:g(function(t){window.addEventListener("mousemove",this.handleMovement);const{pointer:e}=this;e.x=t.clientX,e.y=t.clientY,this.transformBehavior()},50),transformBehavior(){const t=this.$el.getBoundingClientRect(),e=this.getCoordinates(t.width/2,t.height/2),n=this.getDistance(this.pointer.x,e.x,this.pointer.y,e.y);if(n>this.distance){this.transform={},this.throttle=500;return}this.throttle=50;const i=`scale(${n/this.distance})`;this.transform={transform:i}},scaleMovement(t,e){const{type:n}=this,i=Math.sign(this.strength)*(Math.abs(t)+Math.abs(e))/10+1;return`scale3d(${n==="scaleX"||n==="scale"?i:1},
      ${n==="scaleY"||n==="scale"?i:1},
      1)`}}};function I(t,e,n,i,s,o){return r.openBlock(),r.createBlock(r.resolveDynamicComponent(n.tag),{style:r.normalizeStyle({...s.transform,...o.transformParameters})},{default:r.withCtx(()=>[r.renderSlot(t.$slots,"default")]),_:3},8,["style"])}const X=y(R,[["render",I]]),F=t=>{t.component("KinesisContainer",M),t.component("KinesisElement",b),t.component("KinesisScroll",S),t.component("KinesisDistance",X)};c.KinesisContainer=M,c.KinesisDistance=X,c.KinesisElement=b,c.KinesisScroll=S,c.kinesisPlugin=F,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
